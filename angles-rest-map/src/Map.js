import React, { useState, useEffect } from 'react';
import ReactMapGL, { Source, Layer, Marker } from 'react-map-gl';
import 'mapbox-gl/dist/mapbox-gl.css';
import startIcon from './postal-code-prefix.svg';  // Custom SVG icon for the start
import endIcon from './postal-code-prefix.svg';      // Custom SVG icon for the end
import './Map.css'; // Custom CSS file

const geojson = {
  type: "FeatureCollection",
  features: [
    {
      type: "Feature",
      geometry: {
        type: "MultiLineString",
        coordinates: [
          [
            [-122.17247, 45.56049], [-122.17267, 45.56039], [-122.17277, 45.56031], [-122.17273, 45.56028],
            // ... (other coordinates)
            [-122.15436, 45.56338], [-122.15437, 45.56341], [-122.15439, 45.56339],
            [-122.15442, 45.56341], [-122.15443, 45.56345], [-122.15441, 45.56355], [-122.15448, 45.56346],
            [-122.1545, 45.5634], [-122.15451, 45.56336], [-122.15451, 45.56332], [-122.15448, 45.56329],
            [-122.15448, 45.56327], [-122.15449, 45.56327], [-122.15455, 45.5633], [-122.15458, 45.56333],
            [-122.15458, 45.56337], [-122.15461, 45.56348], [-122.15457, 45.56356], [-122.15457, 45.5637],
            [-122.15453, 45.56386], [-122.15455, 45.56395], [-122.15472, 45.5642], [-122.15471, 45.56423],
            [-122.15463, 45.56426], [-122.15455, 45.56432], [-122.15448, 45.56438], [-122.15455, 45.56436],
            [-122.15468, 45.56431], [-122.15477, 45.56427], [-122.15485, 45.56423], [-122.15483, 45.56429],
            [-122.15472, 45.56436], [-122.15464, 45.56443], [-122.15456, 45.56448], [-122.15443, 45.56453],
            [-122.15461, 45.56451], [-122.15478, 45.56446], [-122.155, 45.56435], [-122.15489, 45.56446],
            [-122.15478, 45.56455], [-122.15465, 45.5646], [-122.15473, 45.56461], [-122.15481, 45.56459],
            [-122.15502, 45.56448], [-122.15521, 45.56441], [-122.15526, 45.56434], [-122.15529, 45.56415],
            [-122.15529, 45.564], [-122.1553, 45.56384], [-122.15535, 45.56374], [-122.15545, 45.56361],
            [-122.15555, 45.56349], [-122.15568, 45.56329], [-122.15583, 45.56312], [-122.15596, 45.56303],
            [-122.15621, 45.56297], [-122.15638, 45.56294], [-122.15655, 45.5629], [-122.15669, 45.56286],
            [-122.15669, 45.56281], [-122.15668, 45.56273], [-122.15661, 45.56267], [-122.15648, 45.5626],
            [-122.15668, 45.56263], [-122.15681, 45.56265], [-122.15702, 45.5627], [-122.15722, 45.56272],
            [-122.1575, 45.56277], [-122.15759, 45.56277], [-122.15748, 45.56269], [-122.15735, 45.56262],
            [-122.15728, 45.56254], [-122.15713, 45.56244], [-122.15704, 45.56237], [-122.15719, 45.56241],
            [-122.15738, 45.56249], [-122.15763, 45.56254], [-122.15786, 45.56259], [-122.15806, 45.56266],
            [-122.15815, 45.56271], [-122.15833, 45.56273], [-122.15853, 45.56275], [-122.15866, 45.56278],
            [-122.15866, 45.56284], [-122.1585, 45.56291], [-122.15834, 45.56301], [-122.15809, 45.56308],
            [-122.15786, 45.56312], [-122.15807, 45.56314], [-122.15822, 45.56314], [-122.15847, 45.56314],
            [-122.1587, 45.5632], [-122.15887, 45.56315], [-122.15915, 45.56302], [-122.15937, 45.56297],
            [-122.15956, 45.56294], [-122.15965, 45.5629], [-122.15968, 45.56286], [-122.15969, 45.56281],
            [-122.15964, 45.56274], [-122.15953, 45.56259], [-122.15953, 45.56234], [-122.15948, 45.56228],
            [-122.15934, 45.56223], [-122.15911, 45.5621], [-122.15895, 45.56205], [-122.15872, 45.56196],
            [-122.15857, 45.56186], [-122.15814, 45.5616], [-122.15794, 45.56127], [-122.15791, 45.56114],
            [-122.158, 45.56116], [-122.15835, 45.56133], [-122.15857, 45.56144], [-122.15877, 45.56149],
            [-122.1588, 45.56149], [-122.15891, 45.56148], [-122.15911, 45.56153], [-122.15947, 45.56157],
            [-122.15966, 45.56161], [-122.15998, 45.56163], [-122.16031, 45.56166], [-122.1606, 45.56174],
            [-122.16095, 45.56181], [-122.16128, 45.56182], [-122.16169, 45.56197], [-122.16172, 45.56199],
            [-122.16184, 45.56209], [-122.16198, 45.56222], [-122.16226, 45.56238], [-122.16237, 45.56263],
            [-122.1625, 45.56273], [-122.16255, 45.56275], [-122.16257, 45.56272], [-122.16255, 45.56255],
            [-122.1626, 45.56245], [-122.16259, 45.5624], [-122.16258, 45.56234], [-122.16265, 45.56219],
            [-122.1627, 45.56205], [-122.16275, 45.56197], [-122.16279, 45.56189], [-122.1629, 45.56177],
            [-122.16291, 45.56172], [-122.16286, 45.56165], [-122.16286, 45.5616], [-122.1629, 45.56156],
            [-122.16296, 45.56155], [-122.16303, 45.56157], [-122.16314, 45.56161], [-122.16323, 45.56161],
            [-122.16338, 45.56156], [-122.16353, 45.56156], [-122.16366, 45.56162], [-122.16381, 45.56168],
            [-122.16414, 45.56173], [-122.16438, 45.56181], [-122.16447, 45.56187], [-122.1646, 45.56191],
            [-122.16464, 45.56195], [-122.16465, 45.56197], [-122.16463, 45.562], [-122.16462, 45.56203],
            [-122.16463, 45.56206], [-122.16454, 45.56213], [-122.1645, 45.56219], [-122.16448, 45.56226],
            [-122.1645, 45.56219], [-122.16454, 45.56213], [-122.16463, 45.56206], [-122.16462, 45.56203],
            [-122.16463, 45.562], [-122.16465, 45.56197], [-122.16469, 45.56201], [-122.16483, 45.56202],
            [-122.16493, 45.562], [-122.16507, 45.56198], [-122.16517, 45.56197], [-122.16548, 45.56193],
            [-122.16578, 45.56189], [-122.16588, 45.56185], [-122.16617, 45.5618], [-122.16639, 45.56174],
            [-122.16672, 45.5617], [-122.16733, 45.56145], [-122.16772, 45.56127], [-122.16792, 45.5611],
            [-122.16809, 45.56102], [-122.16827, 45.561], [-122.16838, 45.56094], [-122.16854, 45.56079],
            [-122.16878, 45.56066], [-122.16895, 45.56067], [-122.16912, 45.56079], [-122.16937, 45.56086],
            [-122.16964, 45.56088], [-122.16994, 45.56093], [-122.17014, 45.56095], [-122.17041, 45.56092],
            [-122.17053, 45.56089], [-122.17073, 45.56091], [-122.17104, 45.56083], [-122.17151, 45.56064],
            [-122.1716, 45.56058], [-122.17202, 45.56038], [-122.17214, 45.56032], [-122.17219, 45.5603],
            [-122.17227, 45.56021], [-122.17236, 45.56018], [-122.17245, 45.56017], [-122.17259, 45.5602],
            [-122.17265, 45.56023], [-122.17273, 45.56028], [-122.17277, 45.56031], [-122.17267, 45.56039],
            [-122.17247, 45.56049]
          ]
        ]
      },
      properties: {
        name: "Angel's Rest",
        desc: "Generated by AllTrails https://www.alltrails.com/"
      }
    }
  ]
};

const Map = () => {
  const [viewport, setViewport] = useState({
    latitude: 45.56049,
    longitude: -122.17247,
    zoom: 15,
    pitch: 45,
    bearing: 0,
  });

  useEffect(() => {
    console.log("Viewport updated:", viewport);
  }, [viewport]);

  const startCoord = geojson.features[0].geometry.coordinates[0][0];
  const endCoord = geojson.features[0].geometry.coordinates[0][geojson.features[0].geometry.coordinates[0].length - 1];

  return (
    <ReactMapGL
      {...viewport}
      width="100%"
      height="100vh"
      mapStyle="mapbox://styles/mapbox/dark-v10"
      onViewportChange={(newViewport) => setViewport(newViewport)}
      mapboxApiAccessToken={process.env.REACT_APP_MAPBOX_ACCESS_TOKEN}
    >
      <Source id="route" type="geojson" data={geojson}>
        <Layer
          id="route"
          type="line"
          source="route"
          layout={{
            'line-join': 'round',
            'line-cap': 'round',
          }}
          paint={{
            'line-color': '#08ff08',
            'line-width': 4,
            'line-opacity': 0.8,
          }}
        />
      </Source>
      <Marker latitude={startCoord[1]} longitude={startCoord[0]}>
        <img src={startIcon} alt="Start" className="marker-icon" />
      </Marker>
      <Marker latitude={endCoord[1]} longitude={endCoord[0]}>
        <img src={endIcon} alt="End" className="marker-icon" />
      </Marker>
    </ReactMapGL>
  );
};

export default Map;
